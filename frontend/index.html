<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Roots - Construyendo un Futuro Verde</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="home.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<header class="header">
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="Green_Roots.jpg" alt="Green Roots Logo" class="logo-img">
                <h1>Green Roots</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="#inicio" class="nav-link">Inicio</a></li>
                <li><a href="#informacion" class="nav-link">Información</a></li>
                <li><a href="#actividades" class="nav-link">Actividades</a></li>
                <li><a href="#voluntariado" class="nav-link">Voluntariado</a></li>
                <li id="novedadesMenuItem"><a href="#novedades" class="nav-link" id="novedades-link">Novedades</a></li> 
            </ul>
            
            <div id="authButtons">
                <a href="login.html" class="login-btn"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</a>
                <a href="registro.html" class="register-btn"><i class="fas fa-user-plus"></i> Registrarse</a>
            </div>
            
            <button id="logoutBtn" class="logout-btn" style="display: none;">
                <i class="fas fa-sign-out-alt"></i> Cerrar sesión
            </button>
            
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>
</header>

<main>
    </main>

<footer class="footer">
    </footer>

<script src="home_script.js"></script> 
<script>
    const loginPage = "login.html";

    // 1. REGISTRO DEL SERVICE WORKER (Mantener)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => console.log('SW registrado.'))
          .catch(error => console.log('Fallo al registrar SW:', error));
      });
    }

    // 2. LÓGICA DE SESIÓN Y VISIBILIDAD DE BOTONES
    function checkSessionAndRenderUI() {
        const userData = sessionStorage.getItem("usuario");
        const authButtons = document.getElementById("authButtons");
        const logoutBtn = document.getElementById("logoutBtn");
        const novedadesMenuItem = document.getElementById("novedadesMenuItem");

        if (userData) {
            // Usuario LOGEADO
            authButtons.style.display = 'none';
            logoutBtn.style.display = 'inline-block';
            novedadesMenuItem.style.display = 'list-item'; // Mostrar Novedades
            
            // 2.1. VERIFICAR EXPIRACIÓN (15 SEGUNDOS)
            const sessionTime = sessionStorage.getItem("sessionTime");
            const now = new Date().getTime();
            const FIFTEEN_SECONDS_MS = 15 * 1000; 
            
            if (!sessionTime || now - parseInt(sessionTime) > FIFTEEN_SECONDS_MS) {
                // Sesión expirada
                sessionStorage.clear();
                alert("Tu sesión ha expirado. Por favor inicia sesión nuevamente.");
                // Forzar la recarga para que el UI se actualice a "deslogeado"
                window.location.reload(); 
            }

        } else {
            // Usuario NO LOGEADO
            authButtons.style.display = 'flex'; // Mostrar Login/Registro
            logoutBtn.style.display = 'none';
            novedadesMenuItem.style.display = 'none'; // Ocultar Novedades
            
            // Aquí ya NO hay redirección forzada a login.html
        }
    }
    
    // Inicializar la verificación al cargar la página
    document.addEventListener('DOMContentLoaded', checkSessionAndRenderUI);

    // 3. CIERRE DE SESIÓN
    document.getElementById("logoutBtn").addEventListener("click", () => {
        sessionStorage.clear();
        alert("Has cerrado sesión correctamente.");
        window.location.href = "index.html"; // Recargar index.html para actualizar la UI
    });
</script>

</body>
</html>
